<!-- Dashboard Content -->
<div id="dashboardContent">
  <!-- Welcome Section -->
  <div class="mb-8">
    <h2 class="text-3xl font-bold mb-2">
      <span
        class="bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent"
      >
        Welcome back <span><%= instructor.name || 'Instructor' %></span>!
      </span>
    </h2>
    <p class="text-lg text-gray-600">
      Manage your courses and inspire students
    </p>
  </div>

  <!-- Stats Cards -->
  <div
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"
  >
    <div
      class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow"
    >
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-600 text-sm">Total Courses</p>
          <p class="text-3xl font-bold text-purple-600" id="totalCourses"><%= stats.totalCourses %></p>
        </div>
        <div class="bg-purple-100 p-3 rounded-full">
          <svg
            class="w-6 h-6 text-purple-600"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
              clip-rule="evenodd"
            />
          </svg>
        </div>
      </div>
    </div>

    <div
      class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow"
    >
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-600 text-sm">Total Students</p>
          <p class="text-3xl font-bold text-purple-600" id="totalStudents"><%= stats.totalEnrollments || 0 %></p>
        </div>
        <div class="bg-purple-100 p-3 rounded-full">
          <svg
            class="w-6 h-6 text-purple-600"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"
            />
          </svg>
        </div>
      </div>
    </div>

    <div
      class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow"
    >
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-600 text-sm">Avg. Rating</p>
          <p class="text-3xl font-bold text-purple-600" id="avgRating"><%= (parseFloat(stats.avgRating) || 0).toFixed(1) %></p>
        </div>
        <div class="bg-purple-100 p-3 rounded-full">
          <svg
            class="w-6 h-6 text-purple-600"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
            />
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity & Quick Actions -->
  <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
    <!-- Recent Courses -->
    <div class="xl:col-span-2">
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-gray-800">
            My Courses
          </h3>
          <a href="/instructor/courses" class="text-purple-600 hover:text-purple-700 font-medium text-sm">
            View All
          </a>
        </div>

        <!-- Search Bar -->
        <div class="mb-6">
          <div class="relative">
            <input 
              type="text" 
              id="dashboardSearchInput"
              placeholder="Search courses by title, category, or status..." 
              class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            >
            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
        </div>

        <div class="space-y-4" id="coursesList">
          <% if (courses && courses.length > 0) { %>
            <% const recentCourses = courses.slice(0, 3); %>
            <% recentCourses.forEach(course => { %>
              <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer course-card" 
                   data-title="<%= course.title.toLowerCase() %>"
                   data-category="<%= (course.category_name || '').toLowerCase() %>"
                   data-status="<%= (course.status || '').toLowerCase() %>"
                   data-course-id="<%= course.id %>"
                   data-course-title="<%= course.title %>"
                   data-course-description="<%= course.description || 'No description available' %>"
                   data-course-category="<%= course.category_name || 'Uncategorized' %>"
                   data-course-price="<%= course.price || 0 %>"
                   data-course-difficulty="<%= course.difficulty_name || 'Unknown' %>"
                   data-course-status="<%= course.status %>"
                   data-course-enrollments="<%= course.enrollment_count || 0 %>"
                   onclick="window.location.href='/instructor/courses/<%= course.id %>'">
                <div class="flex items-center space-x-4">
                  <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                    </svg>
                  </div>
                  <div>
                    <h4 class="font-semibold text-gray-800"><%= course.title %></h4>
                    <p class="text-sm text-gray-600"><%= course.enrollment_count || 0 %> students • <%= course.status %></p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="font-semibold text-gray-800">$<%= course.price || 0 %></p>
                  <p class="text-sm text-gray-600">0.0/5 ⭐</p>
                </div>
              </div>
            <% }); %>
          <% } else { %>
            <!-- Show empty state -->
            <div class="text-center py-8">
              <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
              </svg>
              <h3 class="text-lg font-semibold text-gray-800 mb-2">No Courses Yet</h3>
              <p class="text-gray-600 mb-4">You haven't created any courses yet.</p>
              <a href="/instructor/courses/create" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                Create Your First Course
              </a>
            </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Students List -->
    <div class="xl:col-span-2">
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-gray-800">
            My Students (<%= students ? students.length : 0 %>)
          </h3>
        </div>

        <div class="space-y-4" id="studentsList">
          <% if (students && students.length > 0) { %>
            <% students.forEach(student => { %>
              <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow">
                <div class="flex items-center space-x-4">
                  <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                    <span class="text-white font-semibold text-lg"><%= student.name.charAt(0).toUpperCase() %></span>
                  </div>
                  <div>
                    <h4 class="font-semibold text-gray-800"><%= student.name %></h4>
                    <p class="text-sm text-gray-600"><%= student.email %></p>
                    <p class="text-xs text-gray-500">Enrolled in <%= student.courses_enrolled %> course<%= student.courses_enrolled !== 1 ? 's' : '' %></p>
                  </div>
                </div>
                <div class="text-right">
                  <div class="mb-2">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
                      <%= student.courses_enrolled %> course<%= student.courses_enrolled !== 1 ? 's' : '' %>
                    </span>
                  </div>
                  <p class="text-sm text-gray-600">Joined <%= new Date(student.joined_date).toLocaleDateString() %></p>
                  <p class="text-xs text-gray-500 truncate max-w-xs" title="<%= student.enrolled_courses %>">
                    <%= student.enrolled_courses %>
                  </p>
                </div>
              </div>
            <% }); %>
          <% } else { %>
            <!-- Show empty state -->
            <div class="text-center py-8">
              <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
              </svg>
              <h3 class="text-lg font-semibold text-gray-800 mb-2">No Students Yet</h3>
              <p class="text-gray-600 mb-4">Students will appear here once they enroll in your courses.</p>
            </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="space-y-6">
      <!-- Quick Actions can be added here -->
    </div>
  </div>

  <!-- Course Detail Modal -->
  <div id="dashboardCourseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 id="dashboardModalTitle" class="text-2xl font-bold text-gray-800">Course Title</h2>
          <button onclick="closeDashboardCourseModal()" class="text-gray-500 hover:text-gray-700">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Course Info -->
          <div class="lg:col-span-2">
            <div class="space-y-6">
              <div>
                <h3 class="font-semibold text-gray-800 mb-2">Description</h3>
                <p id="dashboardModalDescription" class="text-gray-600"></p>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div>
                  <h3 class="font-semibold text-gray-800 mb-2">Category</h3>
                  <p id="dashboardModalCategory" class="text-gray-600"></p>
                </div>
                <div>
                  <h3 class="font-semibold text-gray-800 mb-2">Price</h3>
                  <p id="dashboardModalPrice" class="text-gray-600"></p>
                </div>
                <div>
                  <h3 class="font-semibold text-gray-800 mb-2">Difficulty</h3>
                  <p id="dashboardModalDifficulty" class="text-gray-600"></p>
                </div>
                <div>
                  <h3 class="font-semibold text-gray-800 mb-2">Status</h3>
                  <p id="dashboardModalStatus" class="text-gray-600"></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Course Stats -->
          <div>
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
              <h3 class="font-semibold text-gray-800 mb-4">Course Statistics</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600">Enrolled Students</span>
                  <span id="dashboardModalEnrollments" class="font-medium">0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Completion Rate</span>
                  <span id="dashboardModalCompletionRate" class="font-medium">0%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Average Rating</span>
                  <span id="dashboardModalRating" class="font-medium">0.0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Total Revenue</span>
                  <span id="dashboardModalRevenue" class="font-medium">$0</span>
                </div>
              </div>
            </div>

            <div class="space-y-3">
              <button onclick="editDashboardCourse()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                Edit Course
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Dashboard search functionality
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('dashboardSearchInput');
    const courseCards = document.querySelectorAll('.course-card');

    function filterCourses() {
      const searchTerm = searchInput.value.toLowerCase();
      let visibleCount = 0;

      courseCards.forEach(card => {
        const title = card.dataset.title;
        const category = card.dataset.category;
        const status = card.dataset.status;
        
        const matchesSearch = title.includes(searchTerm) || 
                            category.includes(searchTerm) || 
                            status.includes(searchTerm);
        
        if (matchesSearch || searchTerm === '') {
          card.style.display = 'flex';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });

      // Show/hide empty state based on search results
      const emptyState = document.querySelector('#coursesList .text-center');
      if (emptyState) {
        if (visibleCount === 0 && searchTerm !== '') {
          emptyState.style.display = 'block';
          emptyState.innerHTML = `
            <div class="text-center py-8">
              <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
              </svg>
              <h3 class="text-lg font-semibold text-gray-800 mb-2">No Courses Found</h3>
              <p class="text-gray-600 mb-4">No courses match your search criteria.</p>
              <button onclick="clearSearch()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-all">
                Clear Search
              </button>
            </div>
          `;
        } else if (visibleCount > 0) {
          emptyState.style.display = 'none';
        }
      }
    }

    function clearSearch() {
      searchInput.value = '';
      filterCourses();
    }

    // Add clear search function to global scope
    window.clearSearch = clearSearch;

    searchInput.addEventListener('input', filterCourses);
  });

  // Dashboard course detail modal functions
  function openDashboardCourseDetail(courseId) {
    // Find the course card with the matching course ID
    const courseCard = document.querySelector(`[data-course-id="${courseId}"]`);
    
    if (courseCard) {
      // Extract course data from the card's data attributes
      const title = courseCard.dataset.courseTitle;
      const description = courseCard.dataset.courseDescription;
      const category = courseCard.dataset.courseCategory;
      const price = courseCard.dataset.coursePrice;
      const difficulty = courseCard.dataset.courseDifficulty;
      const status = courseCard.dataset.courseStatus;
      const enrollments = courseCard.dataset.courseEnrollments;
      
      // Populate modal with course data
      document.getElementById('dashboardModalTitle').textContent = title;
      document.getElementById('dashboardModalDescription').textContent = description;
      document.getElementById('dashboardModalCategory').textContent = category;
      document.getElementById('dashboardModalPrice').textContent = `$${price}`;
      document.getElementById('dashboardModalDifficulty').textContent = difficulty;
      document.getElementById('dashboardModalStatus').textContent = status;
      document.getElementById('dashboardModalEnrollments').textContent = enrollments;
      
      // Calculate revenue (enrollments * price)
      const revenue = (parseInt(enrollments) * parseFloat(price)).toFixed(2);
      document.getElementById('dashboardModalRevenue').textContent = `$${revenue}`;
      
      // Store course ID for other operations
      document.getElementById('dashboardCourseModal').setAttribute('data-course-id', courseId);
      
      // Show modal
      document.getElementById('dashboardCourseModal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    } else {
      alert('Course not found');
    }
  }

  function closeDashboardCourseModal() {
    document.getElementById('dashboardCourseModal').classList.add('hidden');
    document.body.style.overflow = 'auto';
  }

  function editDashboardCourse() {
    const courseId = document.getElementById('dashboardCourseModal').getAttribute('data-course-id');
    window.location.href = `/instructor/courses/${courseId}/edit`;
  }

  function viewFullCourse() {
    const courseId = document.getElementById('dashboardCourseModal').getAttribute('data-course-id');
    window.location.href = `/instructor/courses/${courseId}`;
  }

  function viewCourseStudents() {
    window.location.href = '/instructor/students';
  }

  // Close modal when clicking outside
  document.getElementById('dashboardCourseModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeDashboardCourseModal();
    }
  });
</script>


