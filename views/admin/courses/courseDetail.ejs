<div class="bg-white rounded-2xl w-full overflow-y-auto">
  <div class="p-6">
    <div class="flex items-center justify-between mb-6">
      <h2 id="modalCourseTitle" class="text-2xl font-bold text-gray-800">
        <%= course.title %>
      </h2>

      <p
        id="modalCourseStatus"
        class="p-2 text-xs font-bold rounded-full <%= course.status === 'published' ? 'bg-green-100 text-green-800' : 'bg-yellow-200 text-yellow-800 px-4' %>"
      >
        <%= course.status %>
      </p>
    </div>

    <div class="grid grid-cols-1 gap-6">
      <!-- Course Info -->
      <div>
        <div class="space-y-10">
          <div>
            <h3 class="font-semibold text-gray-800 mb-2">Description</h3>
            <p
              id="modalCourseDescription"
              class="bg-gray-50 text-gray-600 border border-gray-200 rounded-lg p-3"
            >
              <%= course.description %>
            </p>
          </div>

          <div
            class="bg-gray-50 text-gray-600 border border-gray-200 rounded-lg grid grid-cols-1 md:grid-cols-2 gap-2"
          >
            <div class="flex justify-between p-3 rounded-lg hover:bg-blue-100">
              <h3 class="font-semibold text-gray-800">Category</h3>
              <p id="modalCourseCategory" class="text-gray-600">
                <%= course.category_name || "N/A" %>
              </p>
            </div>
            <div class="flex justify-between p-3 rounded-lg hover:bg-blue-100">
              <h3 class="font-semibold text-gray-800">Price</h3>
              <p
                id="modalCoursePrice"
                class="<%= course.price > 0 ? 'text-gray-600' : 'text-teal-500 font-medium' %>"
              >
                <% if (course.price > 0) { %> $ <%= course.price %> <% } else {
                %> Free <% } %>
              </p>
            </div>
            <div class="flex justify-between p-3 rounded-lg hover:bg-blue-100">
              <h3 class="font-semibold text-gray-800">Difficulty</h3>
              <p id="modalCourseDifficulty" class="text-gray-600">
                <%= course.difficulty_level || "N/A" %>
              </p>
            </div>

            <div
              class="flex justify-between p-3 rounded-lg hover:bg-blue-100 pointer-events-auto group"
            >
              <h3 class="font-semibold text-gray-800">Instructor Name</h3>
              <% if (course.instructor_id) { %>
              <a
                href="/admin/instructors/<%= course.instructor_id %>"
                class="text-gray-600 group-hover:underline cursor-pointer"
              >
                <%= course.instructor_name %>
              </a>
              <% } else { %>
              <p class="text-gray-600 pointer-events-none">Not Assigned</p>
              <% } %>
            </div>

            <div class="flex justify-between p-3 rounded-lg hover:bg-blue-100">
              <h3 class="font-semibold text-gray-800">Total Duration</h3>
              <p class="text-gray-600">
                <% let totalDuration = 0; if (course.lessons &&
                course.lessons.length > 0) { course.lessons.forEach(lesson => {
                if (lesson.duration_mins) { totalDuration +=
                Number(lesson.duration_mins); } }); } %> <%=
                (Number(totalDuration)/60).toFixed(1) %> h
              </p>
            </div>

            <div class="flex justify-between p-3 rounded-lg hover:bg-blue-100">
              <span class="font-semibold text-gray-800">Created Date</span>
              <span class="text-gray-600"
                ><%= course.created_at.toLocaleDateString() %></span
              >
            </div>

            <div class="flex justify-between p-3 rounded-lg hover:bg-blue-100">
              <span class="font-semibold text-gray-800">Enrolled Students</span>
              <span id="modalEnrolledStudents" class="font-medium"
                ><%= course.total_students %></span
              >
            </div>

            <div class="flex justify-between p-3 rounded-lg hover:bg-blue-100">
              <span class="font-semibold text-gray-800">Total Revenue</span>
              <span id="modalTotalRevenue" class="font-medium"
                >$ <%= course.price * course.total_students || 0 %></span
              >
            </div>
          </div>

          <div>
            <h3 class="font-semibold text-gray-800 mb-2">
              Learning Objectives
            </h3>

            <% if (course.objectives && course.objectives.length > 0) { %>
            <ul
              class="bg-gray-50 text-gray-600 border border-gray-200 rounded-lg p-3 list-disc list-inside space-y-1"
            >
              <% course.objectives.split(' | ').map(objective => { %> <% if
              (objective.trim()) { %>
              <li><%= objective.trim() %></li>
              <% } %> <% }) %>
            </ul>
            <% } else { %>
            <p
              class="no-items bg-gray-50 text-gray-600 border border-gray-200 rounded-lg p-3"
            >
              No objectives listed
            </p>
            <% } %>
          </div>

          <div>
            <h3 class="font-semibold text-gray-800 mb-2">Prerequisites</h3>

            <% if (course.prerequisites && course.prerequisites.trim().length >
            1) { %>
            <ul
              class="bg-gray-50 text-gray-600 border border-gray-200 rounded-lg p-3 list-disc list-inside space-y-1"
            >
              <% course.prerequisites.split(' | ').map(prerequisite => { %> <%
              if (prerequisite.trim()) { %>
              <li><%= prerequisite.trim() %></li>
              <% } %> <% }) %>
            </ul>
            <% } else { %>
            <p
              class="no-items bg-gray-50 text-gray-600 border border-gray-200 rounded-lg p-3"
            >
              No background knowledge/skills are required for this course.
            </p>
            <% } %>
          </div>

          <div>
            <div>
              <h3 class="font-semibold text-gray-800 mb-2">Course Lessons</h3>

              <% if (course.lessons && course.lessons.length > 0) { %>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-2">
                <!-- Lessons List - Left Column -->
                <div class="lg:col-span-1">
                  <div class="space-y-2">
                    <% course.lessons.map((lesson, index) => { %>
                    <div
                      class="lesson-item bg-blue-50 border border-blue-200 rounded-lg p-3 cursor-pointer hover:bg-blue-100 transition-colors <%= index === 0 ? 'border-blue-400 bg-blue-100' : '' %>"
                      data-lesson-id="<%= lesson.id %>"
                      data-video-url="<%= lesson.video_url || '' %>"
                      data-lesson-title="<%= lesson.title %>"
                    >
                      <div class="flex items-center justify-between">
                        <div class="flex-1">
                          <span class="text-sm font-medium text-gray-800 block">
                            Lesson <%= lesson.lesson_no %>: <%= lesson.title %>
                          </span>
                          <% if (lesson.description) { %>
                          <span class="text-xs text-gray-600 block mt-1">
                            <%= lesson.description %>
                          </span>
                          <% } %>
                        </div>
                        <span class="text-xs text-gray-600 ml-2">
                          <%= lesson.duration_mins || 'N/A' %> mins
                        </span>
                      </div>
                    </div>
                    <% }) %>
                  </div>
                </div>

                <!-- Video Player - Right Column -->
                <div class="lg:col-span-1">
                  <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h4
                      class="text-lg font-semibold text-gray-800 mb-3"
                      id="current-lesson-title"
                    >
                      <%= course.lessons[0] ? 'Lesson ' +
                      course.lessons[0].lesson_no + ': ' +
                      course.lessons[0].title : 'Select a lesson' %>
                    </h4>
                    <div class="video-container">
                      <% if (course.lessons[0] && course.lessons[0].embed_url) {
                      %>

                      <iframe
                        id="videoFrame"
                        class="w-full h-80 max-w-full border border-gray-200 rounded-lg dark:border-gray-700"
                        src="<%= course.lessons[0].embed_url %>"
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media"
                        allowfullscreen
                      >
                      </iframe>

                      <% } else if (course.lessons[0].video_url) { %>
                      <video
                        id="lesson-video"
                        class="w-full h-80 max-w-full border border-gray-200 rounded-lg dark:border-gray-700"
                        controls
                        preload="metadata"
                      >
                        <source
                          src="<%= course.lessons[0].video_url %>"
                          type="video/mp4"
                        />
                      </video>

                      <% } else { %>
                      <div
                        class="w-full h-80 border border-gray-200 rounded-lg bg-gray-100 flex items-center justify-center"
                      >
                        <div class="text-center text-gray-500">
                          <svg
                            class="mx-auto h-12 w-12 text-gray-400 mb-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
                            />
                          </svg>
                          <p class="text-sm">
                            No video available for this lesson
                          </p>
                        </div>
                      </div>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
              <% } else { %>
              <div
                class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center"
              >
                <svg
                  class="mx-auto h-12 w-12 text-gray-400 mb-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                  />
                </svg>
                <p class="text-gray-600">No lessons available yet</p>
                <p class="text-sm text-gray-500 mt-1">
                  Lessons will appear here once they are added to the course.
                </p>
              </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="space-y-3">
          <button
            onclick="window.location.href='/admin/edit-course/<%= course.id %>' "
            class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
          >
            Edit Course
          </button>
          <!-- <button
            class="w-full border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors"
          >
            Duplicate Course
          </button> -->
          <button
            class="w-full bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors btn-delete"
            data-action="/admin/delete-course/<%= course.id %>"
            data-confirm-message="Are you sure you want to delete <%= course.title %> course? This action cannot be undone."
          >
            Delete Course
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const lessonItems = document.querySelectorAll(".lesson-item");
    const currentLessonTitle = document.getElementById("current-lesson-title");
    const videoContainer = document.querySelector(".video-container");

    lessonItems.forEach(function (item) {
      item.addEventListener("click", function () {
        // Remove active class from all lesson items
        lessonItems.forEach(function (lesson) {
          lesson.classList.remove("border-blue-400", "bg-blue-100");
          lesson.classList.add("border-blue-100", "bg-blue-50");
        });

        // Add active class to clicked lesson
        this.classList.remove("border-blue-100", "bg-blue-50");
        this.classList.add("border-blue-400", "bg-blue-100");

        // Get lesson data
        const lessonId = this.getAttribute("data-lesson-id");
        const videoUrl = this.getAttribute("data-video-url") || "";
        const lessonTitle = this.getAttribute("data-lesson-title");
        const lessonNumber =
          this.querySelector("span").textContent.split(":")[0];

        // Update lesson title
        currentLessonTitle.textContent = lessonNumber + ": " + lessonTitle;

        // Update video source
        const url = videoUrl.trim();
        if (url) {
          const isYouTubeWatch = url.includes("youtube.com/watch?v=");
          const isYouTubeShort = url.includes("youtu.be/");

          if (isYouTubeWatch || isYouTubeShort) {
            let videoId = "";
            if (isYouTubeWatch) {
              videoId = url.split("v=")[1] || "";
            } else if (isYouTubeShort) {
              videoId = url.split("youtu.be/")[1] || "";
            }

            const embedUrl = videoId
              ? `https://www.youtube.com/embed/${videoId}`
              : "";

            if (embedUrl) {
              videoContainer.innerHTML = `
                <iframe 
                  id="videoFrame"
                  class="w-full h-80 max-w-full border border-gray-200 rounded-lg dark:border-gray-700"
                  src="${embedUrl}"
                  title="YouTube video player" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media" 
                  allowfullscreen>
                </iframe>
              `;
              return;
            }
          }

          // Non-YouTube url -> use HTML5 video
          videoContainer.innerHTML = `
            <video
              id="lesson-video"
              class="w-full h-80 max-w-full border border-gray-200 rounded-lg dark:border-gray-700"
              controls
              preload="metadata"
            >
              <source src="${url}" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          `;
        } else {
          // Show no video message
          videoContainer.innerHTML = `
            <div class="w-full h-80 border border-gray-200 rounded-lg bg-gray-100 flex items-center justify-center">
              <div class="text-center text-gray-500">
                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
                <p class="text-sm">No video available for this lesson</p>
              </div>
            </div>
          `;
        }
      });
    });
  });
</script>
